# Схема базы данных для Dvorfs Repository Manager

## Таблица `users`
Хранит информацию о пользователях системы.

| Колонка | Тип | Описание |
|---|---|---|
| `id` | `UUID` | Первичный ключ, уникальный идентификатор пользователя. |
| `username` | `VARCHAR(255)` | Уникальное имя пользователя для входа. |
| `password_hash` | `VARCHAR(255)` | Хеш пароля пользователя. |
| `email` | `VARCHAR(255)` | Уникальный адрес электронной почты. |
| `created_at` | `TIMESTAMP` | Время создания записи. |
| `updated_at` | `TIMESTAMP` | Время последнего обновления записи. |

## Таблица `roles`
Хранит роли для управления доступом (RBAC).

| Колонка | Тип | Описание |
|---|---|---|
| `id` | `UUID` | Первичный ключ, уникальный идентификатор роли. |
| `name` | `VARCHAR(255)` | Уникальное название роли (например, `admin`, `developer`). |
| `privileges` | `JSONB` | Список привилегий, связанных с ролью. |
| `created_at` | `TIMESTAMP` | Время создания записи. |

## Таблица `user_roles`
Промежуточная таблица для связи "многие-ко-многим" между пользователями и ролями.

| Колонка | Тип | Описание |
|---|---|---|
| `user_id` | `UUID` | Внешний ключ, ссылается на `users.id`. |
| `role_id` | `UUID` | Внешний ключ, ссылается на `roles.id`. |

## Таблица `repositories`
Хранит конфигурацию репозиториев.

| Колонка | Тип | Описание |
|---|---|---|
| `id` | `UUID` | Первичный ключ. |
| `name` | `VARCHAR(255)` | Уникальное имя репозитория. |
| `format` | `VARCHAR(50)` | Формат репозитория (`npm`, `maven`, `docker`, `raw`). |
| `type` | `VARCHAR(50)` | Тип репозитория (`hosted`, `proxy`, `group`). |
| `attributes` | `JSONB` | Специфичные атрибуты для типа репозитория (например, URL для `proxy`). |
| `cleanup_policy_id` | `UUID` | Внешний ключ, ссылается на `cleanup_policies.id` (может быть `NULL`). |
| `created_at` | `TIMESTAMP` | Время создания записи. |
| `updated_at` | `TIMESTAMP` | Время последнего обновления записи. |

## Таблица `artifacts`
Хранит метаданные об артефактах.

| Колонка | Тип | Описание |
|---|---|---|
| `id` | `UUID` | Первичный ключ. |
| `repository_id` | `UUID` | Внешний ключ, ссылается на `repositories.id`. |
| `path` | `TEXT` | Путь к артефакту внутри репозитория. |
| `size` | `BIGINT` | Размер артефакта в байтах. |
| `content_type` | `VARCHAR(255)` | MIME-тип артефакта. |
| `checksums` | `JSONB` | Контрольные суммы (например, `md5`, `sha1`). |
| `created_at` | `TIMESTAMP` | Время загрузки артефакта. |
| `last_downloaded_at` | `TIMESTAMP` | Время последнего скачивания. |

## Таблица `cleanup_policies`
Хранит правила для автоматической очистки артефактов.

| Колонка | Тип | Описание |
|---|---|---|
| `id` | `UUID` | Первичный ключ. |
| `name` | `VARCHAR(255)` | Название политики. |
| `criteria` | `JSONB` | Критерии для очистки (например, `{"maxAgeDays": 30, "keepLastN": 5}`). |
| `created_at` | `TIMESTAMP` | Время создания записи. |
| `updated_at` | `TIMESTAMP` | Время последнего обновления записи. |
